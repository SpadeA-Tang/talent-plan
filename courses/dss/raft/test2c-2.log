 --- Apply Entry { x: 4920611510952197857 } index 138
 --- Apply Entry { x: 15340343053980740686 } index 139
[2] snapshot, index 139
 --- Apply Entry { x: 5887882986196204681 } index 140
 --- Apply Entry { x: 13560466300827618497 } index 141
 --- Apply Entry { x: 6954860024439275618 } index 142
 --- Apply Entry { x: 2043505443355572867 } index 143
 --- Apply Entry { x: 8671663111323461024 } index 144
disconnect(0)
connect(0)
Initial start command Entry { x: 3349980577132237633 }
[1] start command of index 145 and term 8
[1] send snapshot to [0]
[1] send entries from 145 to 145 to peer 2
[1] start command Entry { x: 3349980577132237633 } at index 145
[0] install snapshot prev index 139 prev term 8
[0] becomes follower at term 5 commit index 130
[2] receive entries(145 - 145) from [1] with term 8 and commit index 144
[2] conflict_index 145 self.commit_index 144
[2] success append entry from 145 to 145
[1] send heartbeat to [0], term 8, commit index 139 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 144 follower state NormalState
[1] received append resp AppendEntryReply { id: 2, success: true, term: 8, index: 145, log_term: 0 }
[1] update commit index to 145
 --- Apply Entry { x: 3349980577132237633 } index 145
[2] becomes follower at term 8 commit index 144
[0] becomes follower at term 8 commit index 139
[1] send heartbeat to [0], term 8, commit index 139 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[2] becomes follower at term 8 commit index 144
[2] update commit index to 145
[0] becomes follower at term 8 commit index 139
 --- Apply Entry { x: 3349980577132237633 } index 145
[1] send heartbeat to [0], term 8, commit index 139 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 139
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 139 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 139
[1] send entries from 140 to 145 to peer 0
[0] receive entries(140 - 145) from [1] with term 8 and commit index 145
[0] conflict_index 140 self.commit_index 139
[0] success append entry from 140 to 145
[0] update commit index to 145
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 145, log_term: 0 }
 --- Apply Entry { x: 5887882986196204681 } index 140
 --- Apply Entry { x: 13560466300827618497 } index 141
 --- Apply Entry { x: 6954860024439275618 } index 142
 --- Apply Entry { x: 2043505443355572867 } index 143
 --- Apply Entry { x: 8671663111323461024 } index 144
 --- Apply Entry { x: 3349980577132237633 } index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[2] becomes follower at term 8 commit index 145
[0] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[2] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
disconnect(2)
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
Initial start command Entry { x: 374912250373781401 }
[1] start command of index 146 and term 8
[1] send entries from 146 to 146 to peer 0
[1] send entries from 146 to 146 to peer 2
[1] start command Entry { x: 374912250373781401 } at index 146
[0] receive entries(146 - 146) from [1] with term 8 and commit index 145
[0] conflict_index 146 self.commit_index 145
[0] success append entry from 146 to 146
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[1] send heartbeat to [0], term 8, commit index 145 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[1] send entries from 146 to 146 to peer 0
[0] receive entries(146 - 146) from [1] with term 8 and commit index 145
[0] conflict_index 0 self.commit_index 145
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 146, log_term: 0 }
[1] update commit index to 146
 --- Apply Entry { x: 374912250373781401 } index 146
[1] send heartbeat to [0], term 8, commit index 146 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 145
[0] update commit index to 146
 --- Apply Entry { x: 374912250373781401 } index 146
[1] start command of index 147 and term 8
[1] send entries from 147 to 147 to peer 0
[1] send entries from 146 to 147 to peer 2
[1] start command Entry { x: 11838350163816898955 } at index 147
[1] start command of index 148 and term 8
[1] send entries from 147 to 148 to peer 0
[1] send entries from 146 to 148 to peer 2
[1] start command Entry { x: 17221292315028008095 } at index 148
[1] start command of index 149 and term 8
[1] send entries from 147 to 149 to peer 0
[1] send entries from 146 to 149 to peer 2
[1] start command Entry { x: 16025120736477307497 } at index 149
[1] start command of index 150 and term 8
[1] send entries from 147 to 150 to peer 0
[1] send entries from 146 to 150 to peer 2
[1] start command Entry { x: 15635177868124377707 } at index 150
[1] start command of index 151 and term 8
[1] send entries from 147 to 151 to peer 0
[1] send entries from 146 to 151 to peer 2
[1] start command Entry { x: 15229065849971455533 } at index 151
[1] start command of index 152 and term 8
[1] send entries from 147 to 152 to peer 0
[1] send entries from 146 to 152 to peer 2
[1] start command Entry { x: 6347047649517053053 } at index 152
[1] start command of index 153 and term 8
[1] send entries from 147 to 153 to peer 0
[1] send entries from 146 to 153 to peer 2
[1] start command Entry { x: 11101727789859321585 } at index 153
[1] start command of index 154 and term 8
[1] send entries from 147 to 154 to peer 0
[1] send entries from 146 to 154 to peer 2
[1] start command Entry { x: 7181465684172251488 } at index 154
[1] start command of index 155 and term 8
[1] send entries from 147 to 155 to peer 0
[1] send entries from 146 to 155 to peer 2
[1] start command Entry { x: 16344620267642909402 } at index 155
[1] start command of index 156 and term 8
[1] send entries from 147 to 156 to peer 0
[1] send entries from 146 to 156 to peer 2
[1] start command Entry { x: 4093067878042656049 } at index 156
[1] start command of index 157 and term 8
[1] send entries from 147 to 157 to peer 0
[1] send entries from 146 to 157 to peer 2
[1] start command Entry { x: 7850169709007581090 } at index 157
Initial start command Entry { x: 4765260537669087494 }
[1] start command of index 158 and term 8
[1] send entries from 147 to 158 to peer 0
[1] send entries from 146 to 158 to peer 2
[1] start command Entry { x: 4765260537669087494 } at index 158
[0] receive entries(147 - 152) from [1] with term 8 and commit index 146
[0] conflict_index 147 self.commit_index 146
[0] success append entry from 147 to 152
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 152, log_term: 0 }
[1] update commit index to 152
 --- Apply Entry { x: 11838350163816898955 } index 147
 --- Apply Entry { x: 17221292315028008095 } index 148
 --- Apply Entry { x: 16025120736477307497 } index 149
[1] snapshot, index 149
 --- Apply Entry { x: 15635177868124377707 } index 150
 --- Apply Entry { x: 15229065849971455533 } index 151
 --- Apply Entry { x: 6347047649517053053 } index 152
[1] send heartbeat to [0], term 8, commit index 152 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] receive entries(147 - 155) from [1] with term 8 and commit index 146
[0] conflict_index 153 self.commit_index 146
[0] success append entry from 153 to 155
[0] receive entries(147 - 158) from [1] with term 8 and commit index 146
[0] conflict_index 156 self.commit_index 146
[0] success append entry from 156 to 158
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 155, log_term: 0 }
[0] receive entries(147 - 154) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] update commit index to 155
[0] receive entries(147 - 147) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 158, log_term: 0 }
[0] receive entries(147 - 148) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] update commit index to 158
[0] receive entries(147 - 149) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 154, log_term: 0 }
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 147, log_term: 0 }
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 148, log_term: 0 }
 --- Apply Entry { x: 11101727789859321585 } index 153
 --- Apply Entry { x: 7181465684172251488 } index 154
 --- Apply Entry { x: 16344620267642909402 } index 155
 --- Apply Entry { x: 4093067878042656049 } index 156
 --- Apply Entry { x: 7850169709007581090 } index 157
 --- Apply Entry { x: 4765260537669087494 } index 158
[0] receive entries(147 - 151) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[0] receive entries(147 - 157) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 151, log_term: 0 }
[0] receive entries(147 - 150) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 157, log_term: 0 }
[0] receive entries(147 - 156) from [1] with term 8 and commit index 146
[0] conflict_index 0 self.commit_index 146
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 150, log_term: 0 }
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 156, log_term: 0 }
[0] becomes follower at term 8 commit index 146
[0] update commit index to 152
 --- Apply Entry { x: 11838350163816898955 } index 147
 --- Apply Entry { x: 17221292315028008095 } index 148
 --- Apply Entry { x: 16025120736477307497 } index 149
[0] snapshot, index 149
 --- Apply Entry { x: 15635177868124377707 } index 150
 --- Apply Entry { x: 15229065849971455533 } index 151
 --- Apply Entry { x: 6347047649517053053 } index 152
[1] send heartbeat to [0], term 8, commit index 158 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state NormalState
[0] becomes follower at term 8 commit index 152
[0] update commit index to 158
 --- Apply Entry { x: 11101727789859321585 } index 153
 --- Apply Entry { x: 7181465684172251488 } index 154
 --- Apply Entry { x: 16344620267642909402 } index 155
 --- Apply Entry { x: 4093067878042656049 } index 156
 --- Apply Entry { x: 7850169709007581090 } index 157
 --- Apply Entry { x: 4765260537669087494 } index 158
disconnect(2)




问题：Apply out of order

server 2正要apply 145
这个时候来了install snapshot，snapshot 会清空 config 那边的log 包括144及以前
而config  收到 145的时候 就意味着 out of order了



connect(2)
Initial start command Entry { x: 2018015632309958089 }
[1] start command of index 159 and term 8
[1] send entries from 159 to 159 to peer 0
[1] send snapshot to [2]
[1] start command Entry { x: 2018015632309958089 } at index 159
[1] send heartbeat to [0], term 8, commit index 158 follower state NormalState
[1] send heartbeat to [2], term 8, commit index 145 follower state SnapshotState
[0] receive entries(159 - 159) from [1] with term 8 and commit index 158
[0] conflict_index 159 self.commit_index 158
[0] success append entry from 159 to 159
[1] received append resp AppendEntryReply { id: 0, success: true, term: 8, index: 159, log_term: 0 }
[1] update commit index to 159
 --- Apply Entry { x: 2018015632309958089 } index 159
[1] snapshot, index 159
[2] becomes follower at term 8 commit index 144
[2] update commit index to 145
[2] install snapshot prev index 149 prev term 8
[2] becomes follower at term 8 commit index 145
 --- Apply Entry { x: 3349980577132237633 } index 145
thread '<unnamed>' panicked at 'server 2 apply out of order 145', raft\src\raft\config.rs:430:21
stack backtrace:
[0] becomes follower at term 8 commit index 158
   0: std::panicking::begin_panic_handler
             at /rustc/c8dfcfe046a7680554bf4eb612bad840e7631c4b\/library\std\src\panicking.rs:515
   1: std::panicking::begin_panic_fmt
             at /rustc/c8dfcfe046a7680554bf4eb612bad840e7631c4b\/library\std\src\panicking.rs:457
   2: raft::raft::config::impl$1::start1_ext::closure$0
             at .\src\raft\config.rs:430